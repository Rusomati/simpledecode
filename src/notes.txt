filterbufize length is shrinking
finish wif
and clean up the code
